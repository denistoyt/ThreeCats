//#region Main page slider
$(() => {
    let MainSlider = new Swiper(".banner-slider", {
        pagination: {
            el: ".swiper-pagination",
            clickable: true,
        },
        autoplay: {
            delay: 2500
        },
        loop: true
    });
})



//#endregion

//#region Masks
$(() => {
    $("input[name='tel']").mask("+7(999)999-9999");
    $('#newsTel').mask("+7(999)999-9999");
})
//#endregion

//#region Accordions

$(() => {
	$('.accordion-head').click(function() {
		$(this).next('.accordion-content').slideToggle(600);
        $(this).toggleClass('active');
	})
})

//#endregion

//#region About us slider
$(() => {
    let ClientsSlider = new Swiper(".clients-slider", {
        autoplay: {
            delay: 2500
        },
        breakpoints: {
            1920: {
                slidesPerView: 'auto',
            },
            991: {
                slidesPerView: 'auto',
            },
            600: {
                slidesPerView: 'auto',
                spaceBetween: 5
            },
            390: {
                slidesPerView: 1
            }
        },
        spaceBetween: 30
    })
    // Open Images
    $('[data-fancybox="patients-gallery"]').fancybox({
        baseClass: "fancy-modal",
        buttons: [
            "close"
        ]
    });
})


//#endregion

//#region Lost slider
$(() => {
    let LostSlider = new Swiper(".lost-slider", {
        lazy: true,
        autoplay: {
            delay: 2500
        },
        breakpoints: {
            1920: {
                slidesPerView: 'auto'
            },
            991: {
                slidesPerView: 'auto'
            },
            600: {
                slidesPerView: 'auto',
                spaceBetween: 5
            },
            390: {
                slidesPerView: 1
            }
        },
        spaceBetween: 10,
        
    })
    $('[data-fancybox="lost-slide"]').fancybox({
        baseClass: "fancy-modal",
        buttons: [
            "close"
        ]
    })
})

//#endregion

//#region Burger menu
$(() => {
    $('.burger-btn').on('click', () => {
        $('.header-burger__content').toggleClass('active').css({'top': $('header').height()});
        $('body').toggleClass('lock')
    })
    if($('.header-burger__content.active')) {
        $(window).resize(() => {
            $('.header-burger__content').css('top', $('header').height());
        })
    }
})

//#endregion

//#region Modals

// Оставить заявку
$(() => {
    $(".footer-submit").on('click', () => {
        $.fancybox.open({
            src: ".modal-submit",
            type: 'inline',
            opts: {
                baseClass: "fancy-modal",
                touch: false
            }
        })
    })
    // TODO: Доделай выбор статуса заявки, чтобы текст подчеркивался
    $("input[name='status']").click((e) => {
        $("input[name='status']").parent().removeClass('selected');
        $("input[name='status']").removeAttr('checked');
        e.target.parentElement.classList.add('selected');
        e.target.setAttribute('checked', '');
    });
    // Зактие модалки после нажатия на "ОК"
    $('.modal-submit-apply_btn').click(() => { $.fancybox.close() })
})

// Предложить новость
$(() => {
    $(".news-header-btn").click(() => {
        $.fancybox.open({
            src: ".modal-news",
            type: 'inline',
            opts: {
                baseClass: 'fancy-modal',
                touch: false,
            }
        })
    })
    $('.modal-news-apply_btn').click(() => { $.fancybox.close(); })
})

// Карточка товара
$(() => {
    $('.items-item-about').click((e) => {
        // Заполнение карточки данными
        let cardId = e.target.dataset.id;
        $.ajax({
            method: "post",
            url: "../php/modals/item.php",
            data: {item_id: cardId},
            success: (e) => {
                $('.modal-item').html(e);
            }
        })
        $.fancybox.open({
            src: ".modal-item",
            type: 'inline',
            opts: {
                baseClass: 'fancy-modal',
                touch: false,
            }
        })
    })
})
//#endregion

//#region Validation
$(() => {
    jQuery.validator.addMethod("checkMask", function(value, element) {
        return /\+\d{1}\(\d{3}\)\d{3}-\d{4}/g.test(value);
   });
   // Оставить заявку
    $('.modal-submit-form').validate({
        errorClass: 'validate-error',
        rules: {
            name: {
                minlength: 2,
                required: true
            },
            tel: {
                checkMask: true,
                required: true
            }
        },
        messages: {
            name: {
                minlength: "Имя должно быть более 2-х символов!",
                required: "Поле обязательно для заполнения"
            },
            tel: {
                required: "Поле обязательно для заполнения",
                checkMask: "Введите корректный номер телефона"
            }
        },
        submitHandler: function(form) {
            // ajax
            $.ajax({
                method: "post",
                url: "../php/forms/submit.php",
                data: {status: $("input[name='status'][checked]").val(), name: $("#submitName").val(), tel: $("#submitTel").val()},
            });
            // apply modal
            // Закрытие главной модалки
            $.fancybox.close();
            // Открытие модалки с благодарностью
            $.fancybox.open({
                src: ".modal-submit-apply",
                type: 'inline',
                opts: {
                    baseClass: 'fancy-modal',
                    touch: false,
                    smallBtn: false,
                    clickSlide: false,
                    clickOutside: false,
                    infobar: false,
                    toolbar: false,
                }
            })
        }
    })
    // Предложить новость
    $('.modal-news-form').validate({
        errorClass: 'validate-error',
        rules: {
            theme: {
                minlength: 2,
                required: true
            },
            text: {
                required: true
            },
            name: {
                minlength: 2,
                required: true
            },
            tel: {
                checkMask: true,
                required: true
            }
        },
        messages: {
            theme: {
                minlength: "Тема должна быть более 2-х символов!",
                required: "Поле обязательно для заполнения"
            },
            text: {
                required: "Поле обязательно для заполнения"
            },
            name: {
                minlength: "Имя должно быть более 2-х символов!",
                required: "Поле обязательно для заполнения"
            },
            tel: {
                required: "Поле обязательно для заполнения",
                checkMask: "Введите корректный номер телефона"
            }
        },
        submitHandler: function(form) {
            // ajax
            $.ajax({
                method: 'post',
                url: "../php/forms/news.php",
                data: $('.modal-news-form').serialize()
            });
            // apply modal
            // Закрытие главной модалки
            $.fancybox.close();
            $.fancybox.open({
                src: ".modal-news-apply",
                type: 'inline',
                opts: {
                    baseClass: 'fancy-modal',
                    touch: false,
                    smallBtn: false,
                    clickSlide: false,
                    clickOutside: false,
                    infobar: false,
                    toolbar: false
                }
            })
        }
    })
    // остались вопросы?
    $('.questions-form').validate({
        errorClass: 'validate-error',
        rules: {
            message: {
                required: true
            },
            name: {
                minlength: 2,
                required: true
            },
            tel: {
                checkMask: true,
                required: true
            },
            email: {
                email: true
            }
        },
        messages: {
            message: {
                required: "Поле обязательно для заполнения"
            },
            name: {
                minlength: "Имя должно быть более 2-х символов!",
                required: "Поле обязательно для заполнения"
            },
            tel: {
                required: "Поле обязательно для заполнения",
                checkMask: "Введите корректный номер телефона"
            },
            email: {
                email: "Введите корректный адрес эл. почты"
            }
        },
        submitHandler: function(form) {
            // ajax
            $.ajax({
                method: "post",
                url: "../php/forms/questions.php",
                data: $('.questions-form').serialize(),
                success: () => { alert('Спасибо за вопрос!'); window.location.reload() } 
            })
        }
    })
})
//#endregion

//#region Tabs

$(function() {
    const tabs = document.querySelector('.tab');
    const tabsBtn = document.querySelectorAll('.tab-menu');
    const tabsContent2 = document.querySelectorAll('.tab-content');
  
    if (tabs) {
        tabs.addEventListener('click', (e) => {
            if (e.target.classList.contains('tab-menu')) {
                const itemTabs = e.target.dataset.itemTab;
                tabsBtn.forEach(el => {el.classList.remove('active', 'orange-block');});
                
                document.querySelector(`[data-item-tab="${itemTabs}"]`).classList.add('active', 'orange-block');
                tabsHandler(itemTabs);
            }
        });
    }
    const tabsHandler = (path) => {
        tabsContent2.forEach(el => {el.classList.remove('active')});
        document.querySelector(`[data-item-tab-target="${path}"]`).classList.add('active');
      };
})
//#endregion

//#region Checkbox states

$(() => {
    // текущая дата
    let date = new Date().toLocaleDateString([], {
        day: "2-digit",
        month: '2-digit',
        year: '2-digit',
    });
    // смена состояния чек-бокса и занесение текущей даты в поле
    $(".check-label span").click((e) => {
        if(e.target.classList.contains("check")) {
            e.target.classList.remove('check');
            e.target.parentElement.parentElement.querySelector(".input").value = "";
        }
        else {
            e.target.classList.add('check');
            e.target.parentElement.parentElement.querySelector(".input").value = date;
        }
    })
    // смена состояния чек-бокса
    $(".check-label-l span").click((e) => {
        if(e.target.classList.contains("check")) {
            e.target.classList.remove('check');
            e.target.parentElement.parentElement.querySelector(".image-download").classList.remove('active');
        }
        else {
            e.target.classList.add('check');
            e.target.parentElement.parentElement.querySelector(".image-download").classList.add('active');
        }
    })
})

//#endregion

//#region Добавление текстовых заготовок в поля

$(() => {
    $(".admin-about-form .admin-about-add_list").click((e) => {
        e.target.parentElement.querySelector(".input-label textarea").innerHTML = "<p class='about-us-text--bold'>Заголовок</p>\r\n<ul>\r\n    <li>Элемент</li>\r\n    <li>Элемент</li>\r\n    <li>Элемент</li>\r\n</ul>";
    })
    $('.admin-about-form input[type=text]').on('keydown', function(e) {
        if (e.which == 13) {
            e.preventDefault();
        }
    });
    $(".admin-lost-form input[type=text]").on('keydown', function(e) {
        if (e.which == 13) {
            e.preventDefault();
        }
    });
})

//#endregion

//#region Выход из профиля администратора 

$(() => {
    $(".admin-panel-user").click(() => {
        $.ajax({
            method: "",
            url: "../functions/admin/exit.php",
            data: {},
            success: (() => {
                location.href = "admin_login.php";
            })
        })
    })
})

//#endregion

//#region Принятие/Отклонение новостей пользователей

$(() => {
    $(".user-news_allow-btn").click((e) => {
        let id = e.target.dataset.newsId;
        let theme = e.target.parentElement.parentElement.querySelector(".user-news__content #userTheme").innerHTML;
        let text = e.target.parentElement.parentElement.querySelector(".user-news__content #userText").innerHTML;
        $.ajax({
            method: "post",
            url: "../functions/admin/user_news.php",
            data: {theme: theme, text: text, id: id},
            success: (() => {
                location.reload();
            })
        })
    })
    $(".user-news_deny-btn").click((e) => {
        let id = e.target.dataset.newsId;
        $.ajax({
            method: "post",
            url: "../functions/admin/user_news.php",
            data: {theme: "", text: "", id: id},
            success: (() => {
                location.reload();
            })
        })
    })
})

//#endregion

//#region НОВОСТИ

    //#region Добавление новости

    $(() => {
        $(".admin-news-add-btn").click(() => {
            let theme = $(".admin-news-add-form #newsTitle").val();
            let text = $(".admin-news-add-form #newsText").val();
            let date = $("input[name='news-add-date']").val();
            let img = "img/news/"+ $(".admin-news-add-form #result b").html();
            $.ajax({
                method: 'post',
                url: "../functions/admin/news_add.php",
                data: {add_theme: theme, add_text: text, add_date: date, add_img: img},
                success: (() => {
                    location.reload();
                })
            })
        })
    })

    //#endregion

    //#region Добавление товара

    $(() => {
        $(".item-add-form .admin-items-add-btn").click(() => {
            let title = $(".item-add-form #itemTitle").val();
            let img = "img/items/" + $(".item-add-form #result b").html();
            let cost = $(".item-add-form #itemCost").val();
            let descr = $(".item-add-form #itemDescr").html();
            $.ajax({
                method: "post",
                url: "../functions/admin/items_add.php",
                data: {add_title: title, add_img: img, add_cost: cost, add_descr: descr},
                success: (()=>{location.reload();})
            })
        }) 
    })

    //#endregion

    //#region Добавление акции

    $(() => {
        $(".admin-discounts-form .admin-discount-add-btn").click(() => {
            let title = $(".discounts-cards__item--add .admin-discounts-form #discountName").val();
            let text = $('.discounts-cards__item--add .admin-discounts-form #discountText').val();
            let date = $('.discounts-cards__item--add .admin-discounts-form #discountDate').val();
            let img = "img/discounts/" + $(".admin-discounts-form #result b").html();
            $.ajax({
                method: "post",
                url: "../functions/admin/discounts.php",
                data: {title_add: title, text_add: text, date_add: date, img_add: img},
                success: (()=>{location.reload();})
            })
        }) 
    })

    //#endregion

    //#region Добавление вакансии

    $(()=>{
        $(".vacancies-cards__item--add .admin-vacancies-form .admin-vacancy-add-btn").click(()=>{
            let name = $(".vacancies-cards__item--add .admin-vacancies-form #vacancyName").val();
            let img = "img/vacancies/" + $(".vacancies-cards__item--add .admin-vacancies-form #result b").html();
            let response = $(".vacancies-cards__item--add .admin-vacancies-form #vacancyDutys").val();
            let requires = $(".vacancies-cards__item--add .admin-vacancies-form #vacancyRequir").val();
            let schedule = $(".vacancies-cards__item--add .admin-vacancies-form #vacancySched").val();
            let pay = $(".vacancies-cards__item--add .admin-vacancies-form #vacancyPay").val();
            $.ajax({
                method: "post",
                url: "../functions/admin/vacancies.php",
                data: {name_add: name, img_add: img, respons_add: response, requires_add: requires, schedule_add: schedule, pay_add: pay},
                success: (()=>{location.reload();})
            })
        })
    })

    //#endregion

    //#region Редактирование новости

    $(() => {
        // кнопка изменить
        $(".admin-news-item--edit").click((e) => {
            let id = e.target.parentElement.dataset.newsId;
            let card = e.target.parentElement.parentElement.parentElement;
            card.remove();
            $(".news-content").css({'flex-direction': 'row-reverse', 'justify-content': 'start'});
            document.querySelector('.admin-news-item--editable').classList.add('active');
            $(".admin-news-item--editable .admin-news-edit-form .news-card__content .admin-news-save-btn").attr("data-news-id", id);
            $(".admin-news-item--editable .admin-news-edit-form .news-card__content .admin-news-delete-btn").attr("data-news-id", id);
            let curr_title = e.target.parentElement.parentElement.parentElement.querySelector(".news-card-title").innerHTML;
            let curr_date = e.target.parentElement.parentElement.parentElement.querySelector(".news-card-date").innerHTML;
            let curr_text = e.target.parentElement.parentElement.parentElement.querySelector(".news-card-info").innerHTML;
            
            $(".admin-news-item--editable #newsTitle").val(curr_title);
            $(".admin-news-item--editable input[name='news-date']").val(curr_date);
            $(".admin-news-item--editable #newsText").val(curr_text);
        })
        // кнопка удалить
        $(".admin-news-delete-btn").click((e) => {
            let id = e.target.dataset.newsId;
            $.ajax({
                method: "post",
                url: "../functions/admin/news_delete.php",
                data: {id: id},
                success: (() => { location.reload(); })
            })
        })
        // кнопка сохранить
        $(".admin-news-save-btn").click((e) => {
            let id = e.target.dataset.newsId;
            let title = $(".admin-news-item--editable #newsTitle").val();
            let date = $(".admin-news-item--editable input[name='news-date']").val();
            let text =  $(".admin-news-item--editable #newsText").val();
            let img = "img/news/" + $(".admin-news-edit-form #result b").html();
            $.ajax({
                method: "post",
                url: "../functions/admin/news_edit.php",
                data: {title: title, date: date, text: text, img: img, id: id},
                success: (()=> {location.reload();})
            })
        })
    })

    //#endregion

    //#region Редактиование товара

    $(() => {
        // редактировать
        $('.admin-items--edit').click((e) => {
            let id = e.target.parentElement.dataset.itemsId;
            let card = e.target.parentElement.parentElement.parentElement;
            card.remove();
            $(".admin-panel-tab__item .items-cards__item--editable").css("order", "-1")
            document.querySelector(".items-cards__item--editable").classList.add('active');
            $(".admin-items-save-btn").attr('data-items-id', id);
            $(".admin-items-delete-btn").attr('data-items-id', id);
            let currTitle = e.target.parentElement.parentElement.parentElement.querySelector(".items-item-title").innerHTML;
            let currCost = e.target.parentElement.parentElement.parentElement.querySelector(".items-item__content .items-item-cost b span").innerHTML;
            let currDescr = e.target.parentElement.parentElement.parentElement.querySelector(".items-item__content .items-item-descr--hidden").innerHTML;

            $(".item-edit-form #itemTitle").val(currTitle);
            $(".item-edit-form #itemCost").val(currCost);
            $(".item-edit-form #itemDescr").html(currDescr);
        })
        // кнопка удалить
        $(".admin-items-delete-btn").click((e) => {
            let id = e.target.dataset.itemsId;
            $.ajax({
                method: "post",
                url: "../functions/admin/items_delete.php",
                data: {id: id},
                success: (() => {location.reload(); })
            })
        })
        // кнопка сохранить
        $(".admin-items-save-btn").click((e) => {
            let id = e.target.dataset.itemsId;
            let title = $(".item-edit-form #itemTitle").val();
            let cost = $(".item-edit-form #itemCost").val();
            let descr =  $(".item-edit-form #itemDescr").html();
            let img = "img/items/" + $(".item-edit-form #result b").html();
            $.ajax({
                method: "post",
                url: "../functions/admin/items_edit.php",
                data: {title: title, add_img: img, cost: cost, descr: descr, id: id},
                success: (()=> {location.reload();})
            })
        })
    })

    //#endregion

    //#region Редактирование вакансии

    $(()=>{
        // редактирование
        $(".vacancies-cards__item .admin-vacancy--edit").click((e)=>{
            let id = e.target.parentElement.dataset.vacanciesId;
            let current_name = e.target.parentElement.parentElement.parentElement.querySelector(".vacancies-item-header h3").innerHTML;
            let current_response = e.target.parentElement.parentElement.parentElement.querySelector(".vacancies-response span").innerHTML;
            let current_requires = e.target.parentElement.parentElement.parentElement.querySelector(".vacancies-requires span").innerHTML;
            let current_schedule = e.target.parentElement.parentElement.parentElement.querySelector(".vacancies-schedule span").innerHTML;
            let current_pay = e.target.parentElement.parentElement.parentElement.querySelector(".vacancies-pay span").innerHTML;
            let card = e.target.parentElement.parentElement.parentElement;
            card.remove();
            document.querySelector(".vacancies-cards .vacancies-cards__item--editable").classList.add("active");
            $(".vacancies-cards .vacancies-cards__item--editable").css('order', '-1');
            $(".vacancies-cards__item--editable .admin-vacancies-form #vacancyName").val(current_name);
            $(".vacancies-cards__item--editable .admin-vacancies-form #vacancyDutys").val(current_response);
            $(".vacancies-cards__item--editable .admin-vacancies-form #vacancyRequir").val(current_requires);
            $(".vacancies-cards__item--editable .admin-vacancies-form #vacancySched").val(current_schedule);
            $(".vacancies-cards__item--editable .admin-vacancies-form #vacancyPay").val(current_pay);
            $(".vacancies-cards__item--editable .admin-vacancies-form .admin-vacancy-save-btn").attr('data-vacancies-id', id);
            $(".vacancies-cards__item--editable .admin-vacancies-form .admin-vacancy-delete-btn").attr('data-vacancies-id', id);
        })
        // удаление
        $(".vacancies-cards__item--editable .admin-vacancies-form .admin-vacancy-delete-btn").click((e)=> {
            let id = e.target.dataset.vacanciesId;
            $.ajax({
                method: "post",
                url: "../functions/admin/vacancies.php",
                data: {id_del: id},
                success: (()=>{location.reload();})
            })
        })
        // обновление
        $(".vacancies-cards__item--editable .admin-vacancies-form .admin-vacancy-save-btn").click((e)=>{
            let id = e.target.dataset.vacanciesId;
            let name = $(".vacancies-cards__item--editable .admin-vacancies-form #vacancyName").val();
            let response = $(".vacancies-cards__item--editable .admin-vacancies-form #vacancyDutys").val();
            let requires = $(".vacancies-cards__item--editable .admin-vacancies-form #vacancyRequir").val();
            let schedule = $(".vacancies-cards__item--editable .admin-vacancies-form #vacancySched").val();
            let pay = $(".vacancies-cards__item--editable .admin-vacancies-form #vacancyPay").val();
            let img = "img/vacancies/" + $(".vacancies-cards__item--editable .admin-vacancies-form #result b").html();
            $.ajax({
                method: "post",
                url: "../functions/admin/vacancies.php",
                data: {name_upd: name, img_upd: img, respons_upd: response, requires_upd: requires, schedule_upd: schedule, pay_upd: pay, id_upd: id},
                success: (()=>{location.reload();})
            })
        })
    })

    //#endregion

    //#region Редактирование акций
        // Редактирование
        $(() => {
            $(".discounts-cards__item .admin-discounts--edit").click((e)=> {
                let id = e.target.parentElement.dataset.discountsId;
                let card = e.target.parentElement.parentElement.parentElement;
                card.remove();
                document.querySelector(".admin-panel-tab__item .discounts .discounts-cards__item--editable").classList.add('active');
                document.querySelector(".admin-panel-tab__item .discounts .discounts-cards__item--editable").style.order = "-1";
                let curr_title = e.target.parentElement.parentElement.parentElement.querySelector(".discounts-item-title").innerHTML;
                let curr_text = e.target.parentElement.parentElement.parentElement.querySelector(".discounts-item-text").innerHTML;
                let curr_date = e.target.parentElement.parentElement.parentElement.querySelector(".discounts-item-date span").innerHTML;

                $('.discounts-cards__item--editable .admin-discounts-form #discountName').val(curr_title);
                $('.discounts-cards__item--editable .admin-discounts-form #discountText').val(curr_text);
                $('.discounts-cards__item--editable .admin-discounts-form #discountDate').val(curr_date);
                $(".discounts-cards__item--editable .admin-discount-save-btn").attr("data-discounts-id", id);
                $(".discounts-cards__item--editable .admin-discount-delete-btn").attr("data-discounts-id", id);
            })
        })
        // Удаление
        $(() => {
            $(".discounts-cards__item--editable .admin-discounts-form .admin-discount-delete-btn").click(() => {
                let id = $(".discounts-cards__item--editable .admin-discounts-form .admin-discount-delete-btn").attr('data-discounts-id');
                $.ajax({
                    method: "post",
                    url: "../functions/admin/discounts.php",
                    data: {id_del: id},
                    success: (()=>{location.reload();})
                });
            });
        })
        // Обновление
        $(() => {
            $(".discounts-cards__item--editable .admin-discounts-form .admin-discount-save-btn").click(()=> {
                let id = $(".discounts-cards__item--editable .admin-discounts-form .admin-discount-save-btn").attr('data-discounts-id');
                let title = $(".discounts-cards__item--editable .admin-discounts-form #discountName").val();
                let text = $(".discounts-cards__item--editable .admin-discounts-form #discountText").val();
                let date = $(".discounts-cards__item--editable .admin-discounts-form #discountDate").val();
                let img = "img/discounts/" + $(".admin-discounts-form #result b").html();
                $.ajax({
                    method: "post",
                    url: "../functions/admin/discounts.php",
                    data: {title_update: title, text_update: text, date_update: date, img_upd: img, id_upd: id},
                    success: (()=>{location.reload();})
                })
            })
        })

    //#endregion

    //#region Редактирование статьи

    $(() => {
        // редактирование
        $(".articles__item .admin-articles--edit").click((e) => {
            let id = e.target.parentElement.dataset.articlesId;
            let card = e.target.parentElement.parentElement.parentElement;
            let curr_title = e.target.parentElement.parentElement.parentElement.querySelector(".articles__item-title").innerHTML;
            let curr_link = e.target.parentElement.parentElement.parentElement.querySelector(".articles__item-title").href;
            card.remove();
            document.querySelector(".admin-panel-content .admin-panel-tab__content .articles-content .articles__item--editable").classList.add('active');
            document.querySelector(".admin-panel-content .admin-panel-tab__content .articles-content .articles__item--editable").style.order = "-1";

            $(".articles__item--editable .admin-articles-form #articleTitle").val(curr_title);
            $(".articles__item--editable .admin-articles-form #articleLink").val(curr_link); 
            $(".articles__item--editable .admin-articles-form .admin-article-save-btn").attr("data-articles-id", id); 
            $(".articles__item--editable .admin-articles-form .admin-article-delete-btn").attr("data-articles-id", id); 
        })
        // добавление
        $(".articles__item--add .admin-articles-form .admin-article-add-btn").click(()=>{
            let title = $(".articles__item--add .admin-articles-form #articleTitle").val();
            let img = "img/articles/" + $(".articles__item--add #result b").html();
            let link = $(".articles__item--add .admin-articles-form #articleLink").val();
            $.ajax({
                method: "post",
                url: "../functions/admin/articles.php",
                data: {title_add: title, img_add: img, link_add: link},
                success: (()=>{location.reload();})
            })
        })
        // удаление
        $(".admin-articles-form .admin-article-delete-btn").click((e)=> {
            let id = e.target.dataset.articlesId;
            $.ajax({
                method: "post",
                url: "../functions/admin/articles.php",
                data: {id_del: id},
                success: (()=>{location.reload();})
            })
        })
        // сохранение
        $(".admin-articles-form .admin-article-save-btn").click((e)=>{
            let id = e.target.dataset.articlesId;
            let title = $(".admin-articles-form #articleTitle").val();
            let img = "img/articles/" + $(".admin-articles-form #result b").html();
            let link = $(".admin-articles-form #articleLink").val();
            $.ajax({
                method: "post",
                url: "../functions/admin/articles.php",
                data: {title_upd: title, img_upd: img, link_upd: link, id_upd: id},
                success: (()=>{location.reload();})
            })
        })
    })

    //#endregion

    //#region Загрузка картинки для страницы новости

    $(() => {
        // функция для загрузки файла
        function DownloadImage(input, handler, message_output) {
            input.change(() => {
                if (window.FormData === undefined) {
                    alert("Ваш браузер не поддерживает данную функцию!");
                } else {
                    let formData = new FormData();
                    formData.append('file', input[0].files[0]);
                    $.ajax({
                        method: "post",
                        url: handler,
                        cache: false,
                        contentType: false,
                        processData: false,
                        data: formData,
                        dataType: 'json',
                        success: ((mess) => {
                            if (mess.error == '') {
                                input.hide();
                                message_output.html(mess.success);
                            }
                            else {
                                message_output.html(mess.error);
                            }
                        })
                    })
                }
            })
        }
        // функция для загрузки файлов
        function MultipleDownload(input, handler, message_output) {
            input.change(function(){
                if (window.FormData === undefined){
                    alert('В вашем браузере FormData не поддерживается')
                } else {
                    var formData = new FormData();
                    $.each(input[0].files,function(key, input){
                        formData.append('file[]', input);
                    });
                    $.ajax({
                        type: "POST",
                        url: handler,
                        cache: false,
                        contentType: false,
                        processData: false,
                        data: formData,
                        dataType : 'json',
                        success: function(data){
                            data.forEach(function(msg) {
                                message_output.append(msg);
                            });
                        }
                    });
                }
            });
        }
        // добавление новости
        DownloadImage($(".admin-news-add-form #newsDownload_2"), "../functions/admin/news_uploads.php", $(".admin-news-add-form #resultFile"));
        // изменение новости
        DownloadImage($(".admin-news-edit-form #newsDownload"), "../functions/admin/news_uploads.php", $(".admin-news-edit-form #resultFile"));
        // добавление товара
        DownloadImage($(".item-add-form #items"), "../functions/admin/items_uploads.php", $(".item-add-form #resultFile"));
        // редактирование товара
        DownloadImage($(".items-cards__item--editable .item-edit-form #itemsDownload"), "../functions/admin/items_uploads.php", $(".item-edit-form #resultFile"));
        // добавление акции
        DownloadImage($('.discounts-cards__item--add .admin-discounts-form #discountsDownload_2'), "../functions/admin/discounts_uploads.php", $('.discounts-cards__item--add .admin-discounts-form #resultFile'));
        // редактирование акции
        DownloadImage($(".discounts-cards__item--editable .admin-discounts-form #discountsDownload"), "../functions/admin/discounts_uploads.php", $(".discounts-cards__item--editable .admin-discounts-form #resultFile"));
        // добавление статьи
        DownloadImage($(".articles__item--add .admin-articles-form #articleDownload_2"), "../functions/admin/articles_uploads.php", $(".articles__item--add .admin-articles-form #resultFile"));
        // редактирование статьи
        DownloadImage($(".articles__item--editable .admin-articles-form #articleDownload"), "../functions/admin/articles_uploads.php", $(".articles__item--editable .admin-articles-form #resultFile"));
        // редактирование ваканисии
        DownloadImage($(".vacancies-cards__item--editable .admin-vacancies-form #vacancyDownload"), "../functions/admin/vacancies_uploads.php", $(".vacancies-cards__item--editable .admin-vacancies-form #resultFile"));
        // добавление ваканисии
        DownloadImage($(".vacancies-cards__item--add .admin-vacancies-form #vacancyDownload_2"), "../functions/admin/vacancies_uploads.php", $(".vacancies-cards__item--add .admin-vacancies-form #resultFile"));
        // добавление картинок пациентов
        MultipleDownload($(".admin-about-form #patientsDownload"), "../functions/admin/patients_uploads.php", $(".admin-about-form #resultFile"));
    })

    //#endregion

//#endregion

//#region Закрытие заявки в админке

$(() => {
    $(".admin-submits_close-btn").click((e) => {
        let id = e.target.dataset.submitsId;
        $.ajax({
            method: "post",
            url: "../functions/submits.php",
            data: {id: id},
            success: (() => {location.reload();})
        })
    })
})

//#endregion

//#region Закрытие вопроса в админке

$(() => {
    $(".question-close-btn").click((e) => {
        let id = e.target.dataset.questionsId;
        $.ajax({
            method: "post",
            url: "../functions/questions.php",
            data: {id: id},
            success: (() =>{location.reload();})
        })
    })
})

//#endregion

//#region Изменение данный "О нас"

$(()=>{
    //Удаление картинок
    $(".admin-about-clients-content .admin-about-clients-content__item .admin-about-clients--delete").click((e)=>{
        let id = e.target.parentElement.dataset.clientsId;
        $.ajax({
            method: "post",
            url: "../functions/admin/about.php",
            data: {id_del: id},
            success: (()=>{location.reload();})
        })
    });
    // Сохранение данных
    $(".admin-about-form .admin-about-save-btn").click(()=>{
        // Сбор имен картинок и добавление а базу
        let imgs = $(".admin-about-form #resultFile p b").toArray();
        let arr = [];
        imgs.forEach((e)=> {
            arr.push("img/patients/" + e.outerText);
        })
        $.ajax({
            method: "post",
            url: "../functions/admin/about.php",
            data: {img_add: arr}
        })
        // Сбор текста
        let par_1 = $(".admin-about-form #aboutFirst").val();
        let par_2 = $(".admin-about-form #aboutSecond").val();
        let par_3 = $(".admin-about-form #aboutThird").val();
        let par_4 = $(".admin-about-form #aboutFourth").val();
        $.ajax({
            method: "post",
            url: "../functions/admin/about.php",
            data: {par_1: par_1, par_2: par_2, par_3: par_3, par_4: par_4},
            success: (()=>{location.reload();})
        })
    })
    

})

//#endregion

//#region Изменение на странице Потеряшки

$(()=>{
    // Удаление картинки из карточки
    $(".admin-lost__images-content__item .admin-lost-item-del").click((e)=>{
        let card = e.target.parentElement.parentElement.parentElement;
        card.remove();
    });
    // Удаление карточки
    $(".admin-lost__item .lost-item-delete").click((e)=>{
        let id = e.target.parentElement.dataset.lostId;
        $.ajax({
            method: "post",
            url: "../functions/admin/lost.php",
            data: {id_del: id},
            success: (()=>{location.reload();})
        })
    })
    // Обновление данных в карточке
    $(".admin-lost__item .admin-lost-save-btn").click((e)=>{
        let id = e.target.dataset.lostId;
        let date = e.target.parentElement.querySelector(".input-date").value;
        let text = e.target.parentElement.querySelector("#lostText").value;
        $.ajax({
            method: "post",
            url: "../functions/admin/lost.php",
            data: {date_upd: date, text_upd: text, id_upd: id},
            success: (()=>{location.reload();})
        })
    })
})

//#endregion
